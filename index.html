<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>PHP Testing Starter by serbanghita</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>PHP Testing Starter</h1>
        <p>Getting started with PHP and UnitTesting, the easy way!</p>

        <p class="view"><a href="https://github.com/serbanghita/PHP-Testing-Starter">View the Project on GitHub <small>serbanghita/PHP-Testing-Starter</small></a></p>


        <ul>
          <li><a href="https://github.com/serbanghita/PHP-Testing-Starter/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/serbanghita/PHP-Testing-Starter/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/serbanghita/PHP-Testing-Starter">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="php-testing-starter" class="anchor" href="#php-testing-starter" aria-hidden="true"><span class="octicon octicon-link"></span></a>PHP Testing Starter</h1>

<blockquote>
<p>Step by step tutorial for developers that want to start testing their web applications.</p>
</blockquote>

<p>This is a step by step tutorial that should help you start testing your PHP application. The goal of this document is ment to:</p>

<ul>
<li>Provide you with a <strong>reliable resource</strong> to start testing your PHP code.</li>
<li>Provide you with <strong>quick copy-paste</strong> code references.</li>
<li>Let you <strong>focus on the important aspects</strong> like writing unit tests.</li>
</ul>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>If you want to contribute to this book, here are a couple of rules to which we adhere:</p>

<ul>
<li>KISS (Keep it simple, stupid) when providing examples and case-studies.</li>
<li>When providing code examples use the conventions that already exists in this book.</li>
<li>Try to provide real world testing scenarios.</li>
</ul>

<h2>
<a id="summary" class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h2>

<p><strong>Chapter 1</strong> - <em>Setting up your project</em></p>

<ul>
<li><a href="#initial-set-up">Initial set-up</a></li>
<li><a href="#files-and-folders-explained">Files and folders explained</a></li>
<li><a href="#downloading-needed-tools">Downloading needed tools</a></li>
<li><a href="#running-the-first-test">Running the first test</a></li>
</ul>

<p><strong>Chapter 2</strong> - <em>Start testing</em></p>

<ul>
<li>Testing by stubbing methods</li>
<li>Testing by mocking objects</li>
</ul>

<p><strong>Chapter 3</strong> - <em>Testing special cases</em></p>

<ul>
<li>Testing <code>protected</code> and <code>private</code> methods</li>
<li>Reading and writing <code>protected</code> and <code>private</code> attributes</li>
<li>Testing methods using data providers</li>
<li><a href="#testing-abstract-classes">Testing <code>abstract</code> classes</a></li>
<li>Testing system specific functions</li>
<li>Testing <code>Exceptions</code> and errors</li>
</ul>

<p><strong>Chapter 4</strong> - <em>Code optimizations</em></p>

<ul>
<li>Making your code testable</li>
<li>Group tests by test suites</li>
</ul>

<p><strong>Chapter 5</strong> - <em>Show me the money!</em></p>

<ul>
<li>Test results </li>
<li>Code coverage</li>
</ul>

<h2>
<a id="chapter-1" class="anchor" href="#chapter-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chapter 1</h2>

<blockquote>
<p>Setting up your project</p>
</blockquote>

<h3>
<a id="initial-set-up" class="anchor" href="#initial-set-up" aria-hidden="true"><span class="octicon octicon-link"></span></a>Initial set-up</h3>

<p>Create your project folder structure. If this is a <strong>new project</strong>, you can use dummy files and classes first and replace them later.
It should look similar to:</p>

<pre><code> |-[+] lib
 |   |- FirstClass.php
 |   \- SecondClass.php
 |
 |-[+] tests
 |  |- [+] fixtures
 |  |- [+] providers
 |  |- [+] lib
 |  |   \- [+] FirstClass
 |  |       |- firstMethodTest.php
 |  |       |- secondMethodTest.php
 |  |       \- constructorTest.php
 |  |
 |  |- phpunit.xml
 |  \- bootstrap.php
 |
 |- .gitignore
 \- composer.json
</code></pre>

<h3>
<a id="files-and-folders-explained" class="anchor" href="#files-and-folders-explained" aria-hidden="true"><span class="octicon octicon-link"></span></a>Files and folders explained</h3>

<p>Our pet PHP project is called <code>MyProject</code>. Remember this, because it's the only fixed notion about this tutorial. We assume that all our files are under a single folder called <code>MyProject</code> and <code>MyProject/lib/</code> is mapped to <code>\MyProject</code> unique namespace.</p>

<p><code>lib/</code> is the folder that contains <strong>all your classes</strong> and main logic. You will find this folder in other projects also named: <code>src</code>, <code>source</code> or similar. The main reason why you should keep everything in one folder (subfoldes) is namespacing your project.</p>

<p><code>FirstClass.php</code> is one of your classes.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">namespace</span> <span class="pl-en">MyProject</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">FirstClass</span></span>
<span class="pl-s2">{</span>
<span class="pl-s2">}</span></pre></div>

<p><code>tests/</code> is the folder containing all your tests and other useful files needed during the testing. In other projects you can find this folder named as <code>test/</code>.</p>

<p><code>tests/fixtures/</code> and <code>tests/providers/</code> can contain static data needed for some specific tests. You can ignore these for now.</p>

<p><code>tests/lib/FirstClass/</code> is a the folder containing all the test files for <code>FirstClass</code> class. In other project this is just a file (e.g. <code>FirstClassTest.php</code>), but you will see later why is better to be a folder. This is entirely up to you and your project.</p>

<p><code>tests/lib/FirstClass/*Test.php</code> are files specific to each method inside the <code>FirstClass</code> class.</p>

<p><code>tests/phpunit.xml</code> is the file with the main PHPUnit configurations. By convention this is stored in an xml file so you don't have to repeat the same commands when running your PHPUnit tests.</p>

<div class="highlight highlight-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s1"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s1"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">phpunit</span>
        <span class="pl-e">colors</span>=<span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>
        <span class="pl-e">verbose</span>=<span class="pl-s1"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>
        <span class="pl-e">bootstrap</span>=<span class="pl-s1"><span class="pl-pds">"</span>bootstrap.php<span class="pl-pds">"</span></span>
        <span class="pl-e">convertErrorsToExceptions</span>=<span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>
        <span class="pl-e">convertNoticesToExceptions</span>=<span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>
        <span class="pl-e">convertWarningsToExceptions</span>=<span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>
        <span class="pl-e">strict</span>=<span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;

    &lt;<span class="pl-ent">testsuite</span> <span class="pl-e">name</span>=<span class="pl-s1"><span class="pl-pds">"</span>All tests<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">directory</span> <span class="pl-e">suffix</span>=<span class="pl-s1"><span class="pl-pds">"</span>Test.php<span class="pl-pds">"</span></span>&gt;lib&lt;/<span class="pl-ent">directory</span>&gt;
    &lt;/<span class="pl-ent">testsuite</span>&gt;
&lt;/<span class="pl-ent">phpunit</span>&gt;</pre></div>

<p><code>tests/bootstrap.php</code> is a file used by the PHPUnit to start your tests. You can put here various global settings. This is the place where to initiate the <strong>autoloader</strong> for your test files.</p>

<div class="highlight highlight-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$composer</span> <span class="pl-k">=</span> <span class="pl-s3">dirname</span>(<span class="pl-c1">__FILE__</span>) <span class="pl-k">.</span> <span class="pl-s1"><span class="pl-pds">'</span>/../vendor/autoload.php<span class="pl-pds">'</span></span>;</span>
<span class="pl-s2"><span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-s3">file_exists</span>(<span class="pl-vo">$composer</span>)) {</span>
<span class="pl-s2">    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-s3">\RuntimeException</span>(<span class="pl-s1"><span class="pl-pds">"</span>Please run 'composer install' first to set up autoloading. <span class="pl-vo">$composer</span><span class="pl-pds">"</span></span>);</span>
<span class="pl-s2">}</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c"> * <span class="pl-k">@var</span> \Composer\Autoload\ClassLoader $autoloader</span></span>
<span class="pl-s2"><span class="pl-c"> */</span></span>
<span class="pl-s2"><span class="pl-vo">$autoloader</span> <span class="pl-k">=</span> <span class="pl-k">include_once</span> <span class="pl-vo">$composer</span>;</span>
<span class="pl-s2"><span class="pl-vo">$autoloader</span><span class="pl-k">-&gt;</span>add(<span class="pl-s1"><span class="pl-pds">'</span>MyProjectTest<span class="pl-cce">\\</span><span class="pl-pds">'</span></span>, <span class="pl-s3">dirname</span>(<span class="pl-c1">__FILE__</span>) <span class="pl-k">.</span> <span class="pl-s1"><span class="pl-pds">'</span>/tests/lib/<span class="pl-pds">'</span></span>);</span></pre></div>

<p><code>MyProjectTest</code> is the namespace where we will keep our tests. The final line of code is optional if you already configured in in <code>composer.json</code>. If you're using your own <strong>autoloader</strong> then you must include it.</p>

<p><code>.gitignore</code> is a file that contains all the directories and files that will be excluded from Git commits.</p>

<pre><code>composer.lock
vendor/
composer.phar
phpunit.phar
</code></pre>

<p>Finally, <code>composer.json</code> is the configuration file for composer. The <code>require-dev</code> and <code>autoload</code> keys are very important for our project to work.</p>

<div class="highlight highlight-json"><pre>{
  <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>yourname/myproject<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>library<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>A demo project.<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>keywords<span class="pl-pds">"</span></span>: [<span class="pl-s1"><span class="pl-pds">"</span>project<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>demo<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>php project<span class="pl-pds">"</span></span>],
  <span class="pl-s1"><span class="pl-pds">"</span>homepage<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>https://github.com/yourname/MyProject<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>license<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>MIT<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>require<span class="pl-pds">"</span></span>: {
    <span class="pl-s1"><span class="pl-pds">"</span>php<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>&gt;=5.3.0<span class="pl-pds">"</span></span>
  },
  <span class="pl-s1"><span class="pl-pds">"</span>require-dev<span class="pl-pds">"</span></span>: {
    <span class="pl-s1"><span class="pl-pds">"</span>phpunit/phpunit<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span>
  },
  <span class="pl-s1"><span class="pl-pds">"</span>autoload<span class="pl-pds">"</span></span>: {
    <span class="pl-s1"><span class="pl-pds">"</span>psr-4<span class="pl-pds">"</span></span>: {
      <span class="pl-s1"><span class="pl-pds">"</span>MyProject<span class="pl-cce">\\</span><span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>lib/<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>MyProjectTest<span class="pl-cce">\\</span><span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>tests/lib/<span class="pl-pds">"</span></span>
    }
  }
}</pre></div>

<h3>
<a id="downloading-needed-tools" class="anchor" href="#downloading-needed-tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>Downloading needed tools</h3>

<ol>
<li>Download latest snapshot of <a href="https://getcomposer.org/composer.phar">composer.phar</a>. Put it in your project's root or make it available global.</li>
<li>Download latest <a href="https://phar.phpunit.de/phpunit.phar">phpunit.phar</a>. Same as above.</li>
</ol>

<h3>
<a id="running-the-first-test" class="anchor" href="#running-the-first-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the first test</h3>

<div class="highlight highlight-sh"><pre><span class="pl-s3">cd</span> MyProject/
php composer.phar diag</pre></div>

<p>You should be <em>OK</em> at this point. If you see any problems here, consult the <a href="#aaa">possible composer issues</a> subsection.</p>

<div class="highlight highlight-sh"><pre>php composer.phar install
php phpunit.phar -c tests/phpunit.xml</pre></div>

<p>The output should be:</p>

<pre lang="text"><code>PHPUnit 4.4.0 by Sebastian Bergmann.
Configuration read from /path/to/MyProject/tests/phpunit.xml
.
Time: 244 ms, Memory: 3.75Mb
OK (1 test, 1 assertion)
</code></pre>

<p>Congratulations! If you made it this far then you might as well think about starring this project and support us.</p>

<h2>
<a id="chapter-3" class="anchor" href="#chapter-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chapter 3</h2>

<blockquote>
<p>Testing special cases</p>
</blockquote>

<h3>
<a id="testing-abstract-classes" class="anchor" href="#testing-abstract-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing abstract classes</h3>

<p>Usually you have classes like this in your code <code>class Socks extends AbstractTransport implements TransportInterface</code>. While in <code>Socks</code> class you're confronted with concrete <code>public</code>, <code>protected</code> and <code>private</code> methods in an abstract class declaration like <code>AbstractTransport</code> you can also have <code>abstract</code> methods.</p>

<p>Abstract methods have no implmenentation hence they will be tested in the class that implements that <code>abstract</code> class (e.g. <code>Socks</code>). So why are we talking about abstract classes and methods? Because <code>abstract</code> classes can have concrete methods implementations and that should be tested!</p>

<p>Let's take an example of <code>abstract</code> class declaration and try to test <code>setPort</code> and <code>getPort</code> signature methods.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-s">abstract</span> <span class="pl-st">class</span> <span class="pl-en">AbstractTransport</span></span>
<span class="pl-s2">{</span>
<span class="pl-s2">  <span class="pl-s">protected</span> <span class="pl-vo">$port</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2">  <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">setPort</span>(<span class="pl-vo">$port</span>)</span>
<span class="pl-s2">  {</span>
<span class="pl-s2">    <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">port</span> <span class="pl-k">=</span> (<span class="pl-st">int</span>)<span class="pl-vo">$port</span>;</span>
<span class="pl-s2">  }</span>
<span class="pl-s2"></span>
<span class="pl-s2">  <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">getPort</span>()</span>
<span class="pl-s2">  {</span>
<span class="pl-s2">    <span class="pl-k">return</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">port</span>;</span>
<span class="pl-s2">  }</span>
<span class="pl-s2">}</span></pre></div>

<p>Here is how you can test both concrete methods from the <code>abstract</code> class <code>AbstractTransport</code>:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     * set port sets the desired port</span></span>
<span class="pl-s2"><span class="pl-c">     */</span></span>
<span class="pl-s2">    <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">testSetPortSetsTheDesiredPort</span>()</span>
<span class="pl-s2">    {</span>
<span class="pl-s2">        <span class="pl-vo">$inputPort</span> <span class="pl-k">=</span> <span class="pl-c1">8080</span>;</span>
<span class="pl-s2">        <span class="pl-vo">$mock</span> <span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>getMockForAbstractClass(<span class="pl-s1"><span class="pl-pds">'</span>\MyProject\Transport\AbstractTransport<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2">        <span class="pl-vo">$mock</span><span class="pl-k">-&gt;</span>setPort(<span class="pl-vo">$inputPort</span>);</span>
<span class="pl-s2"></span>
<span class="pl-s2">        <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>assertEquals(<span class="pl-vo">$inputPort</span>, <span class="pl-vo">$mock</span><span class="pl-k">-&gt;</span>getPort());</span>
<span class="pl-s2">    }</span></pre></div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/serbanghita">serbanghita</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>